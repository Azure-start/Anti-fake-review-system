# 区块链电商防刷评系统 - 配置说明

## 一、环境要求

- **Node.js**: >= 20.19.0 或 >= 22.12.0
- **npm**: 随Node.js自动安装
- **浏览器**: Chrome/Firefox/Brave/Opera（需安装MetaMask插件）
- **MetaMask**: 最新版本

## 二、安装步骤

### 1. 克隆项目

```bash
git clone <repository-url>
cd Anti-fake-review-system
```

### 2. 安装依赖

```bash
npm install
```

安装的核心依赖包括：
- vue@3.5.22
- vue-router@4.6.3
- pinia@3.0.3
- element-plus@2.11.5
- ethers@6.15.0
- axios@1.12.2
- vite@7.1.10

### 3. 环境配置

创建 `.env.development` 文件（开发环境配置）：

```env
# 后端API地址
VITE_API_BASE_URL=http://localhost:3000/api

# 区块链网络配置
VITE_CHAIN_ID=11155111
VITE_CHAIN_NAME=Sepolia
```

创建 `.env.production` 文件（生产环境配置）：

```env
# 生产环境后端API地址
VITE_API_BASE_URL=https://api.yourdomain.com/api

# 区块链网络配置
VITE_CHAIN_ID=11155111
VITE_CHAIN_NAME=Sepolia
```

## 三、运行项目

### 开发模式

```bash
npm run dev
```

访问 http://localhost:5173

### 生产构建

```bash
npm run build
```

构建产物输出到 `dist/` 目录

### 预览生产构建

```bash
npm run preview
```

## 四、配置说明

### Vite配置 (vite.config.js)

```javascript
{
  server: {
    port: 5173,  // 开发服务器端口
    proxy: {
      '/api': {
        target: 'http://localhost:3000',  // 代理到后端服务器
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/api/, '/api')
      }
    }
  }
}
```

### 路由配置

主要路由：
- `/` - 首页（商品列表）
- `/login` - 登录页
- `/product/:id` - 商品详情
- `/checkout` - 确认订单
- `/transactions` - 交易记录
- `/review/:productId` - 发布评价
- `/rewards` - 我的奖励
- `/account` - 我的账户

### API接口配置

所有API请求统一封装在 `src/api/` 目录：

- `authApi.js` - 认证相关接口
  - `getNonce(address)` - 获取签名nonce
  - `signIn(data)` - 签名登录

- `productApi.js` - 商品相关接口
  - `getProductList(params)` - 获取商品列表
  - `getProductDetail(productId)` - 获取商品详情
  - `getProductReviews(productId, params)` - 获取评价列表
  - `submitReview(data)` - 提交评价

- `transactionApi.js` - 交易相关接口
  - `createTransaction(data)` - 创建交易
  - `getUserTransactions(params)` - 获取交易记录
  - `getTransactionDetail(transactionId)` - 获取交易详情

- `rewardApi.js` - 奖励相关接口
  - `getRewardBalance()` - 获取奖励余额
  - `getRewardHistory(params)` - 获取奖励记录
  - `exchangeCoupon(data)` - 兑换优惠券

### 区块链配置

测试网络配置（Sepolia）：
- Chain ID: 11155111
- RPC URL: https://sepolia.infura.io/v3/
- 区块浏览器: https://sepolia.etherscan.io/

测试币获取：
1. 访问 https://sepoliafaucet.com/
2. 输入钱包地址申请测试币
3. 等待到账

## 五、常见问题

### 1. 连接钱包失败

**问题**: 点击连接钱包按钮没有反应

**解决方案**:
- 确保已安装MetaMask插件
- 检查MetaMask是否已解锁
- 确保MetaMask已切换到Sepolia测试网络

### 2. API请求404错误

**问题**: 请求接口返回404错误

**解决方案**:
- 确保后端服务已启动（端口3000）
- 检查 `.env` 文件配置是否正确
- 查看浏览器控制台Network面板确认请求地址

### 3. 网络切换失败

**问题**: 无法切换到Sepolia测试网络

**解决方案**:
- 在MetaMask中手动添加Sepolia网络
- 网络配置信息：
  - 网络名称: Sepolia Test Network
  - RPC URL: https://sepolia.infura.io/v3/YOUR_INFURA_KEY
  - 链ID: 11155111
  - 货币符号: ETH
  - 区块浏览器: https://sepolia.etherscan.io

### 4. 签名登录失败

**问题**: 签名后提示登录失败

**解决方案**:
- 检查后端服务是否正常运行
- 确认钱包地址已正确发送
- 查看后端日志获取详细错误信息

### 5. 交易支付失败

**问题**: MetaMask提示交易失败

**解决方案**:
- 确保钱包有足够的测试币
- 检查Gas费设置是否合理
- 确认网络拥堵情况

### 6. 图片上传失败

**问题**: 上传评价图片不成功

**解决方案**:
- 检查图片大小是否超过限制
- 确认图片格式是否支持（JPG/PNG）
- 检查后端图片上传接口是否正常

## 六、开发调试

### 浏览器开发者工具

使用Chrome DevTools或Firefox开发者工具：
- **Console**: 查看console日志
- **Network**: 监控API请求和响应
- **Application**: 查看localStorage存储

### Vue DevTools

安装Vue DevTools浏览器插件：
- Chrome: [Vue.js devtools](https://chrome.google.com/webstore/detail/vuejs-devtools)
- Firefox: [Vue.js devtools](https://addons.mozilla.org/firefox/addon/vue-js-devtools)

功能：
- 查看组件树
- 监控状态变化
- 性能分析

### MetaMask调试

MetaMask日志查看：
1. 打开MetaMask设置
2. 进入"高级设置"
3. 开启"日志记录"

## 七、部署说明

### 静态资源部署

```bash
# 构建生产版本
npm run build

# dist目录内容可部署到:
# - Nginx
# - Apache
# - CDN
# - Vercel
# - Netlify
```

### Nginx配置示例

```nginx
server {
    listen 80;
    server_name yourdomain.com;
    
    root /var/www/dist;
    index index.html;
    
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    # 代理API请求到后端
    location /api {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

### 环境变量配置

生产环境需要配置：
- 后端API地址
- 区块链RPC节点
- 图片上传CDN地址

## 八、安全注意事项

1. **私钥安全**: 私钥存储在MetaMask中，不传输到服务器
2. **HTTPS部署**: 生产环境必须使用HTTPS
3. **API密钥**: 不要在代码中硬编码API密钥
4. **XSS防护**: Element Plus已内置XSS防护
5. **CSRF防护**: 使用token机制防护CSRF攻击

## 九、技术支持

遇到问题可以：
1. 查看项目README
2. 查看浏览器控制台错误
3. 查看后端服务日志
4. 提交Issue到项目仓库

## 十、相关链接

- Vue 3: https://cn.vuejs.org/
- Element Plus: https://element-plus.org/zh-CN/
- Ethers.js: https://docs.ethers.io/
- MetaMask: https://docs.metamask.io/
- Sepolia Faucet: https://sepoliafaucet.com/
- Sepolia Explorer: https://sepolia.etherscan.io/


