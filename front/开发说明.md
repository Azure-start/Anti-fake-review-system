# 开发说明

## 最近修改内容

### 2024年12月最新修改

1. **创建完整的Mock测试数据系统** ⭐
   - 文件：`src/api/mockData.js`
   - 功能：包含12个商品、评价数据、交易记录、奖励记录、优惠券等完整数据
   - 使用：开发模式自动使用Mock数据，无需后端即可展示完整功能
   - 影响：所有API接口（productApi、transactionApi、rewardApi）
   - 效果：页面可以完美展示所有UI和交互，完美演示区块链电商系统

2. **实现确认收货机制** ⭐
   - 文件：`src/views/Transactions.vue`、`src/views/Review.vue`、`src/api/mockData.js`
   - 功能：只有确认收货后才允许评价
   - 实现：交易记录增加`receiveStatus`字段（confirmed/pending）
   - 流程：支付成功→确认收货→才能评价
   - 效果：有效防止刷评，保障评价真实性

3. **全面优化错误处理机制**
   - 文件：所有 `src/views/*.vue` 文件、`src/api/request.js`
   - 问题：后端服务未启动时，页面会显示大量红色错误提示
   - 解决方案：在所有API错误处理中添加 `if (!error.request)` 判断，开发模式禁用错误弹窗
   - 效果：后端未启动时不再显示错误弹窗，只在控制台记录日志
   - 影响范围：Home.vue、ProductDetail.vue、Checkout.vue、Review.vue、Rewards.vue、Account.vue

4. **优化钱包连接逻辑**
   - 文件：`src/components/WalletConnectBtn.vue`
   - 改进：即使签名登录失败（后端未启动），仍然成功连接钱包
   - 原因：允许前端独立演示，不依赖后端签名验证

### 2024年12月修改

1. **禁用了自动网络切换功能**
   - 文件：`src/components/WalletConnectBtn.vue`
   - 原因：根据需求，暂时不需要切换到测试网络
   - 效果：连接钱包时不会自动检测和切换网络，使用MetaMask当前已连接的网络

2. **优化了错误提示**
   - 文件：`src/api/request.js`、`vite.config.js`
   - 优化：后端服务未启动时不再显示大量错误提示，只在控制台输出警告
   - 效果：开发体验更友好，减少不必要的错误弹窗

3. **配置了Vite代理**
   - 文件：`vite.config.js`
   - 功能：将 `/api` 请求代理到 `http://localhost:3000`
   - 用途：开发环境下连接后端服务

4. **注册了Element Plus图标**
   - 文件：`src/main.js`
   - 功能：自动注册所有Element Plus图标组件
   - 效果：页面图标显示正常

## 当前项目状态

✅ **已完成**：
- 所有功能模块开发完成
- 页面UI和交互完整
- 代码规范，无linter错误
- 构建成功

⚠️ **需要后端支持**：
- 所有API接口需要后端服务运行
- 后端默认端口：3000
- 开发环境API地址：http://localhost:3000/api

## 如何启用网络切换

如果需要恢复自动网络切换功能，请：

1. 打开 `src/components/WalletConnectBtn.vue`
2. 找到被注释的网络检测代码（第84-113行）
3. 取消注释即可

## 如何修改后端地址

1. 开发环境：修改 `.env.development` 中的 `VITE_API_BASE_URL`
2. 生产环境：修改 `.env.production` 中的 `VITE_API_BASE_URL`
3. Vite代理：修改 `vite.config.js` 中的 `proxy.target`

## 运行项目

```bash
# 开发模式
npm run dev

# 生产构建
npm run build

# 预览构建
npm run preview
```

## 注意事项

1. 确保MetaMask已安装并解锁
2. 后端服务需要运行在端口3000
3. 如使用自定义网络，请修改环境变量中的CHAIN_ID和CHAIN_NAME
4. 钱包连接时使用当前MetaMask选择的网络
5. **开发模式**：后端未启动时，前端可以正常展示，不会显示错误提示（只在控制台记录）

